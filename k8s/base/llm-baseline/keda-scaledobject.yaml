apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: mistral-7b-baseline-scaler
  namespace: llm-baseline
spec:
  scaleTargetRef:
    name: mistral-7b-instruct-vllm
  minReplicaCount: 1
  maxReplicaCount: 10
  cooldownPeriod: 300 # 5 minutes
  pollingInterval: 15
  triggers:
    - type: prometheus
      metadata:
        serverAddress: http://prometheus.observability.svc:9090
        metricName: vllm_num_requests_waiting
        query: avg(vllm_num_requests_waiting{namespace="llm-baseline"})
        threshold: "5" # Scale up when avg queue > 5
